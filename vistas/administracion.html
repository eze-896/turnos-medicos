<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administración del Sistema Médico</title>
    <link rel="stylesheet" href="estilos/registro_medico.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        <h1>Administración del Sistema Médico</h1>
    </header>

    <nav class="menu-admin">
        <ul>
            <li><a href="#" onclick="mostrarSeccion('agregar-medico')">Agregar Médico</a></li>
            <li><a href="#" onclick="mostrarSeccion('gestionar-medicos')">Gestionar Médicos</a></li>
        </ul>
    </nav>

    <main>
       <!-- Sección para Agregar/Editar Médico (reutilizable) -->
<div id="seccion-agregar-medico" class="seccion">
    <div id="form-container">
        <h2 id="form-titulo">Agregar Nuevo Médico</h2>
        <button type="button" id="volver-lista" onclick="mostrarSeccion('gestionar-medicos')" style="display: none;">Volver a Lista</button>
        <form id="form-registro-medico">
            <input type="hidden" id="id_medico" name="id_medico" value=""> <!-- Para modo edit -->
            <fieldset>
                <legend>Datos Personales</legend>
                <label for="dni">DNI:</label>
                <input type="text" id="dni" name="dni" placeholder="DNI" required maxlength="8">
                <br>
                <label for="nombre">Nombre:</label>
                <input type="text" id="nombre" name="nombre" placeholder="Nombre" required maxlength="50">
                <br>
                <label for="apellido">Apellido:</label>
                <input type="text" id="apellido" name="apellido" placeholder="Apellido" required maxlength="50">
                <br>
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" placeholder="Email" required>
                <br>
                <label for="contrasena">Contraseña:</label>
                <input type="password" id="contrasena" name="contrasena" placeholder="Contraseña" required minlength="8">
                <br>
                <label for="telefono">Teléfono:</label>
                <input type="tel" id="telefono" name="telefono" placeholder="Teléfono" required maxlength="10">
                <br>
            </fieldset>

            <fieldset>
                <legend>Especialidades (Selecciona múltiples)</legend>
                <div id="lista-especialidades" class="checkbox-group">
                    <!-- Cargado dinámicamente -->
                </div>
            </fieldset>

            <fieldset>
                <legend>Días Laborables (Selecciona múltiples)</legend>
                <div id="lista-dias" class="checkbox-group">
                    <!-- Cargado dinámicamente -->
                </div>
            </fieldset>

            <button type="submit" id="btn-submit">Registrar Médico</button>
        </form>
        <div id="mensaje-respuesta"></div>
    </div>
</div>

<div id="seccion-gestionar-medicos" class="seccion" style="display: none;">
    <h2>Gestionar Médicos</h2>
    <button onclick="mostrarSeccion('agregar-medico'); resetForm();" style="margin-bottom: 10px;">Agregar Nuevo Médico</button>
    <div id="mensaje-tabla"></div>
    <div id="tabla-container">
        <table id="tabla-medicos">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Email</th>
                    <th>Teléfono</th>
                    <th>Especialidades</th>
                    <th>Días</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <!-- Cargado dinámicamente via JS -->
            </tbody>
        </table>
    </div>
</div>

    <script src="control_vistas/registro_medico.js"></script>
    <script src="control_vistas/gestionar_medicos.js"></script>
    <script>
    // Función modular para mostrar secciones (MODIFICADA: No recarga checkboxes en edit)
    function mostrarSeccion(seccionId) {
        const secciones = document.querySelectorAll('.seccion');
        secciones.forEach(secc => secc.style.display = 'none');
        document.getElementById('seccion-' + seccionId).style.display = 'block';
        
        if (seccionId === 'gestionar-medicos') {
            cargarTablaMedicos(); // Cargar tabla al mostrar
        } else if (seccionId === 'agregar-medico') {
            // Verifica si es modo edit
            const esModoEdit = $('#id_medico').val() !== '';
            if (!esModoEdit) {
                console.log('mostrarSeccion: Modo CREATE → Ejecutando resetForm() y cargando checkboxes');
                resetForm(); // Solo reset en modo agregar nuevo
                // Solo en create: Carga checkboxes (primera vez)
                if (!window.checkboxesCargados) { // Usa la flag global
                    cargarEspecialidades();
                    cargarDias();
                }
            } else {
                console.log('mostrarSeccion: Modo EDIT → Saltando reset y recarga de checkboxes (preservando marcas)');
                // En edit: No hace nada con checkboxes (lo maneja editarMedico post-llamada)
            }
        }
    }
    // Inicializa mostrando agregar-medico (modo create)
    mostrarSeccion('agregar-medico');
</script>
</body>
</html>